rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secures a user's entire data tree, including their profile and any subcollections.
     * @path /users/{userId} and /users/{userId}/{subcollection}/{documentId}
     * @allow (read, write) An authenticated user accessing or modifying any document within their own data tree.
     * @deny (list on /users) Listing the top-level 'users' collection is not granted by this rule, preventing user enumeration.
     * @principle Enforces strict data ownership for a user's entire document hierarchy.
     */
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    /**
     * @description Manages access to Foundation level multiple-choice questions.
     * @path /mcqs_foundation/{mcqId}
     * @allow (get, list) Any user, authenticated or not, reading the questions.
     * @deny (create, update, delete) Any user trying to modify the shared question bank.
     * @principle Provides public read access for shared content while securing writes.
     */
    match /mcqs_foundation/{mcqId} {
      allow read, list: if true;
      allow write: if false; // Writes are disabled. Add auth logic for admins/creators.
    }

    /**
     * @description Manages access to Intermediate level multiple-choice questions.
     * @path /mcqs_intermediate/{mcqId}
     * @allow (get, list) Any user, authenticated or not, reading the questions.
     * @deny (create, update, delete) Any user trying to modify the shared question bank.
     * @principle Provides public read access for shared content while securing writes.
     */
    match /mcqs_intermediate/{mcqId} {
      allow read, list: if true;
      allow write: if false; // Writes are disabled. Add auth logic for admins/creators.
    }

    /**
     * @description Manages access to Final level multiple-choice questions.
     * @path /mcqs_final/{mcqId}
     * @allow (get, list) Any user, authenticated or not, reading the questions.
     * @deny (create, update, delete) Any user trying to modify the shared question bank.
     * @principle Provides public read access for shared content while securing writes.
     */
    match /mcqs_final/{mcqId} {
      allow read, list: if true;
      allow write: if false; // Writes are disabled. Add auth logic for admins/creators.
    }
  }
}
